'Por() Miguel Angel Mejia Zaragoza
'Fecha: 7 de abril de 2011        
'editado por Luis Angel Muñoz Franco
'Fecha: 6 de Julio de 2019

Sub Main()   
     
    ' Si la ventana va a aparecer maximizada
    'Me.windowsMode = 0
 
    Me.Caption = Ambiente.Empresa               
 
    Me.formatoDeDinero = "##,##0.00"
    Me.formatoDeDineroTotales = "##,##0.00"  
    Me.formatoDeDescuento = "##,##0"

    Version2005
    Me.MaxPartidas = 8

    ' Limpiamos los mensajes 
    txtFields(3) = ""

    ' La variable reload si es falsa indica que la ventana del punto de venta
    ' todavia no realiza una venta
    if Reload = False Then        
       Ambiente.Tag = 2
       Script.RunProcess "PUNTOV053", Parent, Ambiente 
    end if

    'txtFields(1) = Ambiente.Uid
    fg2.Redraw = False
    AjustaFlexGrid fg2
    fg2.Redraw = True                   
     
    ' Coloca o quita la columna del impuesto                                    
    'fg2.ColWidth(5) = 1000

   	If Trim("" & Ambiente.rstEstacion("serieRemision")) = "" Then
   		Me.consecutivoRemisiones = Ambiente.Estacion & "Remision"
   	Else		
   		Me.consecutivoRemisiones = Trim( "" & Ambiente.rstEstacion("serieRemision") ) & "Remision"
   	End If

   	If Trim("" & Ambiente.rstEstacion("serieTicket")) = "" Then
		Me.consecutivoTickets = Ambiente.Estacion & "Ticket"
   	Else
   		Me.consecutivoTickets = Trim("" & Ambiente.rstEstacion("serieTicket")) & "Ticket"
   	End If

   	Me.serieFactura = Trim("" & Ambiente.rstEstacion("serieFactura"))
   	Me.serieTicket = Trim("" & Ambiente.rstEstacion("serieTicket"))
   	Me.serieRemision = Trim("" & Ambiente.rstEstacion("serieRemision"))

    If Trim(Me.serieTicket) = "" Then
    	Me.serieTicket = Ambiente.Estacion
	End If

	If Trim(Me.serieRemision) = "" Then
      	Me.serieRemision = Ambiente.Estacion
	End If
   'Me.modeloScanner = "Scanner"
   'Me.ActivaScannerOPOS
   Me.usuarioRequerido = 0                      
   fg2.ColWidth(18) = 0


'//--------------------- comienza impresión de ticket por entrada a punto de venta 
If Ambiente.var9 Then

cLineaNueva = Chr(13) & Chr(10)
cSalida = ""                                              

'Encabezado
cSalida = cSalida & cLineaNueva & cLineaNueva 
'"CreaRecordSet()" consulta si el usuario colocó algun mensaje en el encabezado y pie del ticket a traves de la utileria "editar texto del ticket" y lo almacena en "rstTextTicket"
Set rstTextTicket = CreaRecordSet( "SELECT * FROM tickettext", Ambiente.Connection ) 

If rstTextTicket.EOF Then 
	cSalida = cSalida & "" & Ambiente.Empresa & cLineaNueva 
	cSalida = cSalida & "" & Trim( Ambiente.Direccion1 ) & cLineaNueva 
	cSalida = cSalida & "" & Trim( Ambiente.Direccion2 ) & cLineaNueva 
	cSalida = cSalida & "" & Trim( Ambiente.Telefonos ) & cLineaNueva 
Else
	cSalida = cSalida & rstTextTicket("textheader") 
End If

cSalida = cSalida & cLineaNueva & "  --------------------------------------------------" & cLineaNueva 

Set fecha = Rst("select CURRENT_TIMESTAMP as fecha", Ambiente.Connection)   
cSalida = cSalida & cLineaNueva & "        Ingreso de Cajero: "
cSalida = cSalida & cLineaNueva & cLineaNueva
cSalida = cSalida & "  Fecha y hora: " & Trim( fecha("fecha") )        
cSalida = cSalida & cLineaNueva & cLineaNueva     
cSalida = cSalida & "  Usuario: " & Trim( Ambiente.Uid )
cSalida = cSalida & cLineaNueva        

cSalida = cSalida & cLineaNueva & "  --------------------------------------------------" & cLineaNueva  


	'msgbox cSalida    
	PrintText cSalida
 	Ambiente.var9 = False
End If                                  

'//-----------------------termina impresión de ticket por entrada a punto de venta

End Sub





Sub Version2005()

    'Me.DevolverEfectivo = True 
	Me.DevolverEfectivo = False
                               
    FormatoCantidad = "##,##0.000"                    
    TimerComodin.Enabled = False   
    TimerComodin.Interval = 4000
    TimerComodin.Enabled = True

    fg2.ColWidth(6) = 5000                
    fg2.ColWidth(9) = 1200        


End Sub